#include "system_gpio.h"
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void GPIOx_PinConfig(GPIO_TypeDef* GPIOx, uint8_t GPIOx_Mode, uint8_t GPIOx_Speed, uint8_t GPIOx_OType, uint8_t GPIOx_OState, uint16_t GPIOx_Pin_y)
{
	uint16_t pin_position = 0;

	// skalowanie maski pinów na decymaln¹ wartosc od 0 do 15
	while(!(GPIOx_Pin_y & (1 << pin_position)))
	{
		pin_position++;
	}

	GPIOx->MODER 	&= ~ (0x03 << (pin_position * 2));
	GPIOx->OTYPER 	&= ~(1 << pin_position);
	GPIOx->OSPEEDR 	&= ~ (0x03 << (pin_position * 2));
	GPIOx->PUPDR 	&= ~ (0x03 << (pin_position * 2));

	GPIOx->MODER 	|= (GPIOx_Mode << pin_position * 2);
	GPIOx->OTYPER 	|= (GPIOx_OType << pin_position);
	GPIOx->OSPEEDR 	|= (GPIOx_Speed << pin_position * 2);
	GPIOx->PUPDR 	|= (GPIOx_OState << pin_position * 2);
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void GPIOx_PinAFConfig(GPIO_TypeDef* GPIOx, uint16_t GPIOx_PinSource, uint8_t GPIOx_AF)
{
  uint32_t temp_1 = 0x00;
  uint32_t temp_2 = 0x00;

  temp_1 = ((uint32_t)(GPIOx_AF) << ((uint32_t)((uint32_t)GPIOx_PinSource & (uint32_t)0x07) * 4));
  GPIOx->AFR[GPIOx_PinSource >> 0x03] &= ~((uint32_t)0xF << ((uint32_t)((uint32_t)GPIOx_PinSource & (uint32_t)0x07) * 4));
  temp_2 = GPIOx->AFR[GPIOx_PinSource >> 0x03] | temp_1;
  GPIOx->AFR[GPIOx_PinSource >> 0x03] = temp_2;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void GPIOx_SetPin(GPIO_TypeDef* GPIOx, uint16_t GPIOx_Pin_y)
{
	GPIOx->BSRR = (uint32_t)GPIOx_Pin_y;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void GPIOx_ResetPin(GPIO_TypeDef* GPIOx, uint16_t GPIOx_Pin_y)
{
	GPIOx->BRR = (uint32_t)GPIOx_Pin_y;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint8_t GPIOx_ReadInputPin(GPIO_TypeDef* GPIOx, uint16_t GPIOx_Pin_y)
{
	if((GPIOx->IDR & GPIOx_Pin_y) == GPIOx_Pin_y)
	{
		return SET;
	}
	else
	{
		return RESET;
	}
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint16_t GPIOx_ReadInputAll(GPIO_TypeDef* GPIOx)
{
	return (GPIOx->IDR);
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint8_t GPIOx_ReadOutputPin(GPIO_TypeDef* GPIOx, uint16_t GPIOx_Pin_y)
{
	if((GPIOx->ODR & GPIOx_Pin_y) == GPIOx_Pin_y)
	{
		return SET;
	}
	else
	{
		return RESET;
	}
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
uint16_t GPIOx_ReadOutputAll(GPIO_TypeDef* GPIOx)
{
	return (GPIOx->ODR);
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void GPIOx_ClockConfig(uint32_t RCC_AHBPeriph, FunctionalState NewState)
{
	if(NewState == ENABLE)
	{
		RCC->AHBENR |= RCC_AHBPeriph;
	}
	else
	{
		RCC->AHBENR &= ~ RCC_AHBPeriph;
	}
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
